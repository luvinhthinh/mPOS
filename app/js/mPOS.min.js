/*! mPOS 2015-10-01 */
window.pos={app:{mainApp:angular.module("myApp",["ui.bootstrap"])},view:{},data:{},helper:{cart:{},transaction:{},utility:{}},controller:{}},function(a){var b=[{cat:"cat1",name:"Food"},{cat:"cat2",name:"Drink"},{cat:"cat3",name:"Special"}],c=[{id:"cat1_1",cat:"cat1",name:"Roll",price:6},{id:"cat1_2",cat:"cat1",name:"Banana",price:6},{id:"cat1_3",cat:"cat1",name:"Pork",price:6},{id:"cat1_4",cat:"cat1",name:"Soup",price:6},{id:"cat1_5",cat:"cat1",name:"Bun",price:6},{id:"cat2_1",cat:"cat2",name:"Sugar Cane",price:5},{id:"cat2_2",cat:"cat2",name:"Coconut",price:4},{id:"cat2_3",cat:"cat2",name:"Coffee",price:4},{id:"cat2_4",cat:"cat2",name:"Lemon Tea",price:2},{id:"cat3_1",cat:"cat3",name:"Spring Roll",price:3},{id:"cat3_2",cat:"cat3",name:"Skewer",price:4},{id:"cat3_3",cat:"cat3",name:"2 for 7",price:7}];a.data={catList:b,itemList:c,getItemById:function(a){return _.find(c,function(b){return b.id==a})}}}(window.pos),function(a){a.getCurrentDate=function(){var a=new Date;return a.getDate()+"_"+(a.getMonth()+1)+"_"+a.getFullYear()},a.sendMessage=function(a,b){var c={replaceLineBreaks:!1,android:{intent:"INTENT"}},d=function(){alert("Message sent successfully")},e=function(a){alert("Message Failed:"+a)};sms.send(a,b,c,d,e)}}(window.pos.helper.utility),function(a,b){a.findItemInCart=function(a,b){return _.find(a,function(a){return a.id==b})},a.updateTotalAmount=function(a){return _.reduce(a,function(a,b){return a+b.price},0)},a.removeFromCart=function(c,d){var e=a.findItemInCart(c,d),f=b.getItemById(d);return e?(e.quantity--,e.price=f.price*e.quantity,0==e.quantity?_.reject(c,function(a){return a.id==d}):c):c},a.addItemToCart=function(c,d){var e=a.findItemInCart(c,d),f=b.getItemById(d);return void 0==e?c.push({id:f.id,name:f.name,quantity:1,price:f.price}):(e.quantity++,e.price=f.price*e.quantity),c}}(window.pos.helper.cart,window.pos.data),function(a){var b="allTrans",c=a.transaction;c.saveTransaction=function(c,d,e){var f=window.localStorage.getItem(b)||"",g={date:a.utility.getCurrentDate(),time:Date.now(),order:c,total:d,payMode:e};return f=JSON.stringify(g)+(""==f?"":",")+f,window.localStorage.setItem(b,f),"success"},c.getTransactionByDate=function(a){return _.filter(c.getAllTransactions(),function(b){return b.date==a})},c.getTransactionByDateAndMode=function(a,b){return _.filter(c.getAllTransactions(),function(c){return c.date==a&&c.payMode==b})},c.getTotalAmount=function(a){return _.reduce(a,function(a,b){return a+b.total},0)},c.getAllTransactions=function(){return JSON.parse("["+(window.localStorage.getItem(b)||"")+"]")}}(window.pos.helper),function(a){a.controller("timeCtrl",["$scope","$timeout",function(a,b){a.clock="loading clock...",a.tickInterval=1e3;var c=function(){a.clock=Date.now(),b(c,a.tickInterval)};b(c,a.tickInterval)}])}(window.pos.app.mainApp),function(a){a.view={getHtmls:function(){return{menu:"menu.html",payment:"pay.html",report:"transaction.html"}}}}(window.pos),function(a,b){a.controller("dropdownCtrl",["$scope","$modal",function(a,c){function d(){var a=c.open({animation:!1,templateUrl:b.getHtmls().report,controller:"reportCtrl",resolve:{}});a.result.then(function(a){},function(){})}a.status={isopen:!1},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.status.isopen=!a.status.isopen},a.report=d}])}(window.pos.app.mainApp,window.pos.view),function(a){a.controller("menuCtrl",["$scope","$modalInstance","items",function(a,b,c){a.items=c,a.addToCart=function(a){b.close(a)}}])}(window.pos.app.mainApp),function(a){var b={CASH:"cash",EFTPOS:"eftpos"};a.controller("payCtrl",["$scope","$modalInstance","amount",function(a,c,d){a.amount=d,a.received="",a.mode="-",a.payBy=function(c){a.mode=c!=b.EFTPOS||window.confirm("Are you sure to pay by EFTPOS ?")?c:"-"},a.complete=function(e){(a.mode==b.CASH&&e>=d||a.mode==b.EFTPOS)&&c.close([a.mode,e])}}])}(window.pos.app.mainApp),function(a,b){var c=b.transaction;a.controller("reportCtrl",["$scope","$modalInstance",function(a,d){var e=b.transaction.getAllTransactions(),f=[];_.each(e,function(a){var b=a.date;_.find(f,function(a){return a.date==b})||f.push({date:b,total:c.getTotalAmount(c.getTransactionByDate(b)),cash:c.getTotalAmount(c.getTransactionByDateAndMode(b,"cash")),eftpos:c.getTotalAmount(c.getTransactionByDateAndMode(b,"eftpos"))})}),a.displayTrans=f,a.ok=function(){d.close()}}])}(window.pos.app.mainApp,window.pos.helper),function(a,b,c,d){var e=b.catList,f=b.itemList,g=d.cart,h=d.transaction;a.controller("myCtrl",["$scope","$modal",function(a,b){function d(){var a=b.open({animation:!1,templateUrl:c.getHtmls().report,controller:"reportCtrl",resolve:{}});a.result.then(function(a){},function(){})}function i(){var b=m.pop();a.cart=b?g.removeFromCart(a.cart,b):a.cart,a.totalAmount=g.updateTotalAmount(a.cart)}function j(){a.cart=[],m=[],a.totalAmount=0,n=""}function k(d){var e=b.open({animation:!1,templateUrl:c.getHtmls().menu,controller:"menuCtrl",resolve:{items:function(){return _.filter(f,function(a){return a.cat==d})}}});e.result.then(function(b){a.cart=g.addItemToCart(a.cart,b),a.totalAmount=g.updateTotalAmount(a.cart),m.push(b)},function(){})}function l(){var d=b.open({animation:!1,templateUrl:c.getHtmls().payment,controller:"payCtrl",resolve:{amount:function(){return a.totalAmount}}});d.result.then(function(b){n=b[0],h.saveTransaction(a.cart,a.totalAmount,n),j()},function(){})}a.catList=e,a.cart=[],a.totalAmount=0;var m=[],n="";a.report=d,a.undo=i,a.clearAll=j,a.open=k,a.pay=l}])}(window.pos.app.mainApp,window.pos.data,window.pos.view,window.pos.helper);